
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JavaScript substr function - php.js</title>
  <meta name="author" content="Kevin van Zonneveld">

  
  <meta name="description" content="JavaScript substr function A JavaScript equivalent of PHP&#8217;s substr strings/substr.js raw on github 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://phpjs.org/functions/substr/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="php.js" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-63083-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <a target="_blank" href="https://github.com/kvz/phpjs">
    <img id="fork-us" style="position: fixed; z-index: 99; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub">
  </a>
  <header role="banner"><hgroup>
  <div id="logo">
    <h1><a href="/">php.js</a></h1>
  	<div class="clear"></div>
  </div>

  
    <h2>A resource of php functions in JavaScript</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:phpjs.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog</a></li>
  <li><a href="/functions">Functions</a></li>
  <li><a href="/authors">Authors</a></li>
  <li><a target="_blank" href="https://github.com/kvz/phpjs/wiki/_pages">Wiki</a></li>
  <li><a target="_blank"  href="http://twitter.com/phpjs">@phpjs</a></li>
  <li><a target="_blank"  href="http://identi.ca/brettz9">@brettz9</a></li>
  <li><a target="_blank"  href="http://twitter.com/kvz">@kvz</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">JavaScript substr function</h1>
    
  </header>
  
  <!-- Generated by Rakefile:build -->


<p>A JavaScript equivalent of PHP&#8217;s substr</p>

<figure class='code'><figcaption><span>strings/substr.js </span><a href='https://raw.github.com/kvz/phpjs/master/functions/strings/substr.js'>raw on github </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">substr</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Returns part of a string</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// version: 909.322</span>
</span><span class='line'>  <span class="c1">// discuss at: http://phpjs.org/functions/substr</span>
</span><span class='line'>  <span class="c1">// +     original by: Martijn Wieringa</span>
</span><span class='line'>  <span class="c1">// +     bugfixed by: T.Wild</span>
</span><span class='line'>  <span class="c1">// +      tweaked by: Onno Marsman</span>
</span><span class='line'>  <span class="c1">// +      revised by: Theriault</span>
</span><span class='line'>  <span class="c1">// +      improved by: Brett Zamir (http://brett-zamir.me)</span>
</span><span class='line'>  <span class="c1">// %    note 1: Handles rare Unicode characters if &#39;unicode.semantics&#39; ini (PHP6) is set to &#39;on&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 1: substr(&#39;abcdef&#39;, 0, -1);</span>
</span><span class='line'>  <span class="c1">// *       returns 1: &#39;abcde&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 2: substr(2, 0, -6);</span>
</span><span class='line'>  <span class="c1">// *       returns 2: false</span>
</span><span class='line'>  <span class="c1">// *       example 3: ini_set(&#39;unicode.semantics&#39;,  &#39;on&#39;);</span>
</span><span class='line'>  <span class="c1">// *       example 3: substr(&#39;a\uD801\uDC00&#39;, 0, -1);</span>
</span><span class='line'>  <span class="c1">// *       returns 3: &#39;a&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 4: ini_set(&#39;unicode.semantics&#39;,  &#39;on&#39;);</span>
</span><span class='line'>  <span class="c1">// *       example 4: substr(&#39;a\uD801\uDC00&#39;, 0, 2);</span>
</span><span class='line'>  <span class="c1">// *       returns 4: &#39;a\uD801\uDC00&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 5: ini_set(&#39;unicode.semantics&#39;,  &#39;on&#39;);</span>
</span><span class='line'>  <span class="c1">// *       example 5: substr(&#39;a\uD801\uDC00&#39;, -1, 1);</span>
</span><span class='line'>  <span class="c1">// *       returns 5: &#39;\uD801\uDC00&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 6: ini_set(&#39;unicode.semantics&#39;,  &#39;on&#39;);</span>
</span><span class='line'>  <span class="c1">// *       example 6: substr(&#39;a\uD801\uDC00z\uD801\uDC00&#39;, -3, 2);</span>
</span><span class='line'>  <span class="c1">// *       returns 6: &#39;\uD801\uDC00z&#39;</span>
</span><span class='line'>  <span class="c1">// *       example 7: ini_set(&#39;unicode.semantics&#39;,  &#39;on&#39;);</span>
</span><span class='line'>  <span class="c1">// *       example 7: substr(&#39;a\uD801\uDC00z\uD801\uDC00&#39;, -3, -1)</span>
</span><span class='line'>  <span class="c1">// *       returns 7: &#39;\uD801\uDC00z&#39;</span>
</span><span class='line'>  <span class="c1">// Add: (?) Use unicode.runtime_encoding (e.g., with string wrapped in &quot;binary&quot; or &quot;Binary&quot; class) to</span>
</span><span class='line'>  <span class="c1">// allow access of binary (see file_get_contents()) by: charCodeAt(x) &amp; 0xFF (see https://developer.mozilla.org/En/Using_XMLHttpRequest ) or require conversion first?</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">allBMP</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">es</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">el</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">se</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// BEGIN REDUNDANT</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>  <span class="c1">// END REDUNDANT</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;unicode.semantics&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;unicode.semantics&#39;</span><span class="p">].</span><span class="nx">local_value</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="s1">&#39;on&#39;</span><span class="o">:</span>
</span><span class='line'>    <span class="c1">// Full-blown Unicode including non-Basic-Multilingual-Plane characters</span>
</span><span class='line'>    <span class="c1">// strlen()</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="sr">/[\uD800-\uDBFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="sr">/[\uDC00-\uDFFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">allBMP</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">allBMP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">es</span> <span class="o">=</span> <span class="p">(</span><span class="nx">start</span> <span class="o">+=</span> <span class="nx">end</span><span class="p">);</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">es</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="sr">/[\uDC00-\uDFFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="sr">/[\uD800-\uDBFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">start</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">es</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">surrogatePairs</span> <span class="o">=</span> <span class="sr">/[\uD800-\uDBFF][\uDC00-\uDFFF]/g</span><span class="p">;</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">((</span><span class="nx">surrogatePairs</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">str</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">surrogatePairs</span><span class="p">.</span><span class="nx">lastIndex</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">li</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">start</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&gt;=</span> <span class="nx">end</span> <span class="o">||</span> <span class="nx">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">el</span> <span class="o">=</span> <span class="p">(</span><span class="nx">end</span> <span class="o">+=</span> <span class="nx">len</span><span class="p">);</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">el</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="sr">/[\uDC00-\uDFFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="sr">/[\uD800-\uDBFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">end</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">el</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&gt;</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">se</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">len</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">se</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">ret</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="sr">/[\uD800-\uDBFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="sr">/[\uDC00-\uDFFF]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">se</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Go one further, since one of the &quot;characters&quot; is part of a surrogate pair</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// Fall-through</span>
</span><span class='line'>  <span class="k">case</span> <span class="s1">&#39;off&#39;</span><span class="o">:</span>
</span><span class='line'>    <span class="c1">// assumes there are no non-BMP characters;</span>
</span><span class='line'>    <span class="c1">//    if there may be such characters, then it is best to turn it on (critical in true XHTML/XML)</span>
</span><span class='line'>  <span class="k">default</span><span class="o">:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">start</span> <span class="o">+=</span> <span class="nx">end</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">end</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">len</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="nx">end</span> <span class="o">:</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">len</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">:</span> <span class="nx">len</span> <span class="o">+</span> <span class="nx">start</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// PHP returns false if start does not fall within the string.</span>
</span><span class='line'>    <span class="c1">// PHP returns false if the calculated end comes before the calculated start.</span>
</span><span class='line'>    <span class="c1">// PHP returns an empty string if start and end are the same.</span>
</span><span class='line'>    <span class="c1">// Otherwise, PHP returns the portion of the string from start to end.</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">start</span> <span class="o">&gt;=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">start</span> <span class="o">&gt;</span> <span class="nx">end</span> <span class="o">?</span> <span class="o">!</span><span class="mi">1</span> <span class="o">:</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// Please Netbeans</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://github.com/kvz/phpjs/blob/master/functions/strings/substr.js">view on github</a></li>
<li><a href="https://github.com/kvz/phpjs/edit/master/functions/strings/substr.js">edit on github</a></li>
</ul>


<h3>Example 1</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">substr</span><span class="p">(</span><span class="s1">&#39;abcdef&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;abcde&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 2</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 3</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;unicode.semantics&#39;</span><span class="p">,</span>  <span class="s1">&#39;on&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">substr</span><span class="p">(</span><span class="s1">&#39;a\uD801\uDC00&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;a&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other PHP functions in the strings extension</h3>

<!-- Generated by Rakefile:build -->


<ul>
<li><a href="/functions/addcslashes">addcslashes</a></li>
<li><a href="/functions/addslashes">addslashes</a></li>
<li><a href="/functions/bin2hex">bin2hex</a></li>
<li><a href="/functions/chop">chop</a></li>
<li><a href="/functions/chr">chr</a></li>
<li><a href="/functions/chunk_split">chunk_split</a></li>
<li><a href="/functions/convert_cyr_string">convert_cyr_string</a></li>
<li><a href="/functions/convert_uuencode">convert_uuencode</a></li>
<li><a href="/functions/count_chars">count_chars</a></li>
<li><a href="/functions/crc32">crc32</a></li>
<li><a href="/functions/echo">echo</a></li>
<li><a href="/functions/explode">explode</a></li>
<li><a href="/functions/get_html_translation_table">get_html_translation_table</a></li>
<li><a href="/functions/html_entity_decode">html_entity_decode</a></li>
<li><a href="/functions/htmlentities">htmlentities</a></li>
<li><a href="/functions/htmlspecialchars">htmlspecialchars</a></li>
<li><a href="/functions/htmlspecialchars_decode">htmlspecialchars_decode</a></li>
<li><a href="/functions/implode">implode</a></li>
<li><a href="/functions/join">join</a></li>
<li><a href="/functions/lcfirst">lcfirst</a></li>
<li><a href="/functions/levenshtein">levenshtein</a></li>
<li><a href="/functions/localeconv">localeconv</a></li>
<li><a href="/functions/ltrim">ltrim</a></li>
<li><a href="/functions/md5">md5</a></li>
<li><a href="/functions/md5_file">md5_file</a></li>
<li><a href="/functions/metaphone">metaphone</a></li>
<li><a href="/functions/money_format">money_format</a></li>
<li><a href="/functions/nl2br">nl2br</a></li>
<li><a href="/functions/nl_langinfo">nl_langinfo</a></li>
<li><a href="/functions/number_format">number_format</a></li>
<li><a href="/functions/ord">ord</a></li>
<li><a href="/functions/parse_str">parse_str</a></li>
<li><a href="/functions/printf">printf</a></li>
<li><a href="/functions/quoted_printable_decode">quoted_printable_decode</a></li>
<li><a href="/functions/quoted_printable_encode">quoted_printable_encode</a></li>
<li><a href="/functions/quotemeta">quotemeta</a></li>
<li><a href="/functions/rtrim">rtrim</a></li>
<li><a href="/functions/setlocale">setlocale</a></li>
<li><a href="/functions/sha1">sha1</a></li>
<li><a href="/functions/sha1_file">sha1_file</a></li>
<li><a href="/functions/similar_text">similar_text</a></li>
<li><a href="/functions/soundex">soundex</a></li>
<li><a href="/functions/split">split</a></li>
<li><a href="/functions/sprintf">sprintf</a></li>
<li><a href="/functions/sscanf">sscanf</a></li>
<li><a href="/functions/str_getcsv">str_getcsv</a></li>
<li><a href="/functions/str_ireplace">str_ireplace</a></li>
<li><a href="/functions/str_pad">str_pad</a></li>
<li><a href="/functions/str_repeat">str_repeat</a></li>
<li><a href="/functions/str_replace">str_replace</a></li>
<li><a href="/functions/str_rot13">str_rot13</a></li>
<li><a href="/functions/str_shuffle">str_shuffle</a></li>
<li><a href="/functions/str_split">str_split</a></li>
<li><a href="/functions/str_word_count">str_word_count</a></li>
<li><a href="/functions/strcasecmp">strcasecmp</a></li>
<li><a href="/functions/strchr">strchr</a></li>
<li><a href="/functions/strcmp">strcmp</a></li>
<li><a href="/functions/strcoll">strcoll</a></li>
<li><a href="/functions/strcspn">strcspn</a></li>
<li><a href="/functions/strip_tags">strip_tags</a></li>
<li><a href="/functions/stripos">stripos</a></li>
<li><a href="/functions/stripslashes">stripslashes</a></li>
<li><a href="/functions/stristr">stristr</a></li>
<li><a href="/functions/strlen">strlen</a></li>
<li><a href="/functions/strnatcasecmp">strnatcasecmp</a></li>
<li><a href="/functions/strnatcmp">strnatcmp</a></li>
<li><a href="/functions/strncasecmp">strncasecmp</a></li>
<li><a href="/functions/strncmp">strncmp</a></li>
<li><a href="/functions/strpbrk">strpbrk</a></li>
<li><a href="/functions/strpos">strpos</a></li>
<li><a href="/functions/strrchr">strrchr</a></li>
<li><a href="/functions/strrev">strrev</a></li>
<li><a href="/functions/strripos">strripos</a></li>
<li><a href="/functions/strrpos">strrpos</a></li>
<li><a href="/functions/strspn">strspn</a></li>
<li><a href="/functions/strstr">strstr</a></li>
<li><a href="/functions/strtok">strtok</a></li>
<li><a href="/functions/strtolower">strtolower</a></li>
<li><a href="/functions/strtoupper">strtoupper</a></li>
<li><a href="/functions/strtr">strtr</a></li>
<li><a href="/functions/substr">substr</a></li>
<li><a href="/functions/substr_compare">substr_compare</a></li>
<li><a href="/functions/substr_count">substr_count</a></li>
<li><a href="/functions/substr_replace">substr_replace</a></li>
<li><a href="/functions/trim">trim</a></li>
<li><a href="/functions/ucfirst">ucfirst</a></li>
<li><a href="/functions/ucwords">ucwords</a></li>
<li><a href="/functions/vprintf">vprintf</a></li>
<li><a href="/functions/vsprintf">vsprintf</a></li>
<li><a href="/functions/wordwrap">wordwrap</a></li>
</ul>


<h2>Legacy comments</h2>

<p>These were imported from our old site. Please use disqus below for new comments</p>

<div style="overflow-y: scroll; max-height: 500px;">
<!-- Generated by Rakefile:build -->

<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2010-05-28 03:17:27 <br />
@dazz: By the way, in addition to my comments just now, be aware that if you try to use some of these 4-byte characters on the web, they could actually cause problems for sites. For example, MySQL will not even store these unless the field is defined as binary. Some sites like Wikipedia are geared to support these characters (and our site because we prepared for it), but they are not yet universally supported in databases, server-side languages (PHP, like JS, can handle them, but does not treat them properly until PHP6), nor text editors, etc. (even some regular 2-byte characters are not displayable in some environments though probably usually due to font support issues, since even if the technology supports Unicode, the font must also support it in order to display it; if you agree that fonts would be ideally auto-downloaded in order to give automatic full coverage of any character without developers needing to use CSS&#8217; @font-face property ( https://developer.mozilla.org/index.php?title=En/CSS/%40font-face ), automatically providing fonts to the browser when the user visits a page requiring support of certain characters, add your vote to the bug report at https://bugzilla.mozilla.org/show_bug.cgi?id=512619 ).
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2010-05-28 03:06:31 <br />
@dazz: Most of the code length (which is code which is only run if you type <pre><code>ini_set('unicode.semantics',  'on');
</code></pre> before running substr) is for those who need to support Unicode 100%. 

Unicode was invented to allow one to display any written character from any language on the same page at the same time, and JavaScript supports this. In the past, one could only use one or a few language scripts on the same page (e.g., ASCII for English, Latin-1 for European languages, etc.).

Each character in Unicode is represented abstractly by a number, so even if you can&#8217;t see it (or if the current font doesn&#8217;t support it), we can talk about a given character.

However, given all of the other written scripts being used in Unicode (i.e., all living scripts and even for many dead written languages), there were so many that once the more common characters of human languages were assigned to slots representable by a single character in JavaScript (2 bytes), there weren&#8217;t any more slots left, so for some rarely used characters (like some ancient Chinese characters) it became necessary to represent them by 2 reserved characters (4 bytes) combined together (individually called &quot;surrogates&quot;, the first in the pair being a &quot;high surrogate&quot; and the second a &quot;low surrogate&quot;) which are not display characters by themselves but as far as memory and JavaScript functions are normally concerned (e.g., string length), they are like 2 full characters.

For example, try this in JavaScript (I recommend &quot;Extension Developer&#8217;s Extension&quot; for Firefox, so you don&#8217;t need to save a file but can just test JavaScript immediately from the toolbar; I like its XUL Editor for this as it evaluates the JavaScript immediately):

<pre><code>alert('槪'.length);</code></pre>

Although the above is only one character as far as appearance and cutting-and-pasting, the code will actually alert &quot;2&quot;!

And if you use <pre><code>alert('槪'.charAt(0));</code></pre> to find out what the first &quot;character&quot; inside that character is (or <pre><code>alert('槪'.charAt(1));</code></pre> to find out what the second one is), you&#8217;ll see a weird number in a box be displayed (at least in Firefox) which means it is a character not supported by one&#8217;s font, and in this case that is because the &quot;character&quot; is not even a character so your font is not going to display this like a character anyways.

So, substr (as it will be in international-friendly PHP6), when in Unicode mode (set by ini_set()) should not mistreat these in a count as though they were 2 characters (it should treat the surrogate pairs as though a single whole character), nor should it potentially cut these characters in half leading to a non-readable character being left over.  Hope that helps explain it a little&#8230; 

Not all of our functions are Unicode friendly in this way (and probably few if any other JavaScript libraries even take this into account in any of their functions) but we should support this for users who wish to use it (especially given that PHP6 is potentially supporting such characters).

@others: Sorry, I hope to get to your comments/patches soon&#8230; Been busy with work deadlines&#8230;
<hr />


<strong>
dazz
</strong>
on 2010-05-27 18:15:31 <br />
wtF?? This Function is veryyy looooong
<hr />


<strong>
<a href="http://chupakabr.ru" rel="nofollow">Val Che</a>
</strong>
on 2010-04-05 14:49:10 <br />
This one workd fine for me too :-) Thanks guys
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-09-05 21:25:01 <br />
@ T.Wild: Sure does, thank you for your bugfix. I&#8217;ve also added a testcase for this situation so it cannot happen again.
<hr />


<strong>
T.Wild
</strong>
on 2008-09-03 00:46:31 <br />
Had a bit of difficulty when this function was passed an integer instead of a string since <pre><code>.substring</code></pre> isn&#8217;t an integer function.

I fixed the error thusly:
<pre><code>
return (&amp;quot;&amp;quot;+f_string).substring(f_start, f_length);
</code></pre>
instead of:
<pre><code>
return f_string.substring(f_start, f_length);
</code></pre>
forcing f_string to be a string, since this is how the PHP version treats the first parameter.
<pre><code>
substr(1234,2,1) = 3;
</code></pre>

hope this helps.
<hr />


</div>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://phpjs.org/functions/substr/index.html" data-via="phpjs" data-counturl="http://phpjs.org/functions/substr/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Kevin van Zonneveld -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
   -
  <span class="credit">Theme by <a href="http://melandri.net/2012/07/23/darkstripes-octopress-theme-released/">alessandro melandri</a></span>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'phpjs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://phpjs.org/functions/substr/index.html';
        var disqus_url = 'http://phpjs.org/functions/substr/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
